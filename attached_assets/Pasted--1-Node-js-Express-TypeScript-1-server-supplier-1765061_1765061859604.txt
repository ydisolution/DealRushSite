×—×œ×§ 1 â€“ ×¦×“ ×©×¨×ª (Node.js + Express + TypeScript)
ğŸ“ 1. ×¦×•×¨ ×§×•×‘×¥ ×—×“×© ×œ×¨××•×˜×™× ×©×œ ×¡×¤×§×™×

server/supplierRoutes.ts (××• ×‘××•×ª×” ×ª×™×§×™×™×” ×©×œ routes.ts)

// server/supplierRoutes.ts
import { Router, Request, Response } from "express";

const router = Router();

/**
 * ×˜×™×¤: ×‘×©×œ×‘ ×¨××©×•×Ÿ × ×©×ª××© ×‘××‘× ×” ×‘×–×™×›×¨×•×Ÿ (in-memory).
 * ××—×¨ ×›×š ××¤×©×¨ ×œ×”×—×œ×™×£ ×œ×“××˜××‘×™×™×¡.
 */

type DealStatus = "draft" | "pending" | "approved" | "live" | "closed";

interface DealTier {
  tierNumber: number;
  minUnits: number;     // ×›××” ×™×—×™×“×•×ª ××›××Ÿ ×•××¢×œ×”
  maxUnits?: number;    // ×¢×“ ×›××” ×™×—×™×“×•×ª (×œ× ×—×•×‘×” ×× ×–×” ×”×˜×™×¨ ×”××—×¨×•×Ÿ)
  unitPrice: number;    // ××—×™×¨ ×œ×™×—×™×“×” ×‘×˜×™×¨ ×”×–×”
}

interface DealCustomer {
  id: string;
  fullName: string;
  email: string;
  phone: string;
  shippingAddress: string;
  unitsPurchased: number;
  unitPricePaid: number;
  purchasedAt: string; // ISO date
}

interface SupplierDeal {
  id: string;
  supplierId: string;    // ××–×”×” ×¡×¤×§ (×›×¨×’×¢ ××¤×©×¨ ×œ×©×™× ×¢×¨×š ×§×‘×•×¢ ×œ×“×•×’××”)
  title: string;
  description: string;
  status: DealStatus;
  regularPrice: number;
  costPrice: number;
  tiers: DealTier[];
  createdAt: string;
  approvedAt?: string;
  closedAt?: string;
  // × ×ª×•× ×™× ××—×•×©×‘×™×/××¦×˜×‘×¨×™×
  customers: DealCustomer[];
  commissionRate: number; // ××—×•×– ×¢××œ×” ×œ×¤×œ×˜×¤×•×¨××” ×œ×“×•×’××” 0.1 = 10%
}

// ×××’×¨ ×–×× ×™ ×‘×–×™×›×¨×•×Ÿ
const deals: SupplierDeal[] = [];

// ×¤×•× ×§×¦×™×” ×©×ª×‘×™× supplierId ××”Ö¾auth ×©×œ×š (×›×¨×’×¢ ×“××™×•× ×™)
function getSupplierIdFromReq(req: Request): string {
  // TODO: ×œ×”×—×œ×™×£ ×œ×§×¨×™××” ×××™×ª×™×ª ××”Ö¾JWT / session
  return "demo-supplier-1";
}

// ×¤×•× ×§×¦×™×” ×©××—×–×™×¨×” × ×ª×•× ×™× ××¦×˜×‘×¨×™× ×œ×“×™×œ
function getDealAggregates(deal: SupplierDeal) {
  const totalUnits = deal.customers.reduce(
    (sum, c) => sum + c.unitsPurchased,
    0
  );
  const grossRevenue = deal.customers.reduce(
    (sum, c) => sum + c.unitsPurchased * c.unitPricePaid,
    0
  );
  const commission = grossRevenue * deal.commissionRate;
  const netRevenue = grossRevenue - commission;

  const avgUnitPrice =
    totalUnits > 0 ? grossRevenue / totalUnits : 0;

  return {
    totalUnits,
    grossRevenue,
    commission,
    netRevenue,
    avgUnitPrice,
  };
}

/**
 * POST /api/suppliers/deals
 * ×™×¦×™×¨×ª ×“×™×œ ×—×“×© (×˜×™×•×˜×”)
 */
router.post("/deals", (req: Request, res: Response) => {
  const supplierId = getSupplierIdFromReq(req);
  const {
    title,
    description,
    regularPrice,
    costPrice,
    tiers,
    commissionRate,
  } = req.body;

  if (!title || !regularPrice || !costPrice) {
    return res.status(400).json({ message: "×—×¡×¨×™× ×©×“×•×ª ×—×•×‘×”" });
  }

  const id = "deal_" + Date.now();
  const now = new Date().toISOString();

  const newDeal: SupplierDeal = {
    id,
    supplierId,
    title,
    description: description || "",
    status: "draft",
    regularPrice: Number(regularPrice),
    costPrice: Number(costPrice),
    tiers: tiers || [],
    commissionRate: commissionRate ?? 0.1, // 10% ×‘×¨×™×¨×ª ××—×“×œ
    createdAt: now,
    customers: [],
  };

  deals.push(newDeal);

  return res.status(201).json(newDeal);
});

/**
 * POST /api/suppliers/deals/:id/submit
 * ×©×œ×™×—×ª ×“×™×œ ×œ××™×©×•×¨ ×”× ×”×œ×ª ×”×¤×œ×˜×¤×•×¨××”
 */
router.post("/deals/:id/submit", (req: Request, res: Response) => {
  const supplierId = getSupplierIdFromReq(req);
  const { id } = req.params;

  const deal = deals.find(
    (d) => d.id === id && d.supplierId === supplierId
  );

  if (!deal) {
    return res.status(404).json({ message: "×“×™×œ ×œ× × ××¦×" });
  }

  if (deal.status !== "draft") {
    return res
      .status(400)
      .json({ message: "××¤×©×¨ ×œ×©×œ×•×— ×œ××™×©×•×¨ ×¨×§ ×“×™×œ ×‘×¡×˜×˜×•×¡ ×˜×™×•×˜×”" });
  }

  deal.status = "pending";
  return res.json(deal);
});

/**
 * (×œ×”× ×”×œ×” â€“ ×œ× ×œ×¡×¤×§, ××‘×œ ×˜×•×‘ ×©×™×”×™×”)
 * POST /api/admin/deals/:id/approve
 * ×××©×¨ ×“×™×œ â€“ ××“××” ×¤×¢×•×œ×” ×©×œ ××“××™×Ÿ
 */
router.post("/admin/deals/:id/approve", (req: Request, res: Response) => {
  const { id } = req.params;
  const deal = deals.find((d) => d.id === id);

  if (!deal) {
    return res.status(404).json({ message: "×“×™×œ ×œ× × ××¦×" });
  }

  deal.status = "approved";
  deal.approvedAt = new Date().toISOString();

  // × ×™×ª×Ÿ ×’× ×œ×”×¢×‘×™×¨ ×œ-live ××•×˜×•××˜×™×ª:
  deal.status = "live";

  return res.json(deal);
});

/**
 * GET /api/suppliers/deals
 * ×¨×©×™××ª ×“×™×œ×™× ×©×œ ×”×¡×¤×§ + × ×ª×•× ×™× ××¦×˜×‘×¨×™×
 */
router.get("/deals", (req: Request, res: Response) => {
  const supplierId = getSupplierIdFromReq(req);

  const supplierDeals = deals
    .filter((d) => d.supplierId === supplierId)
    .map((d) => ({
      ...d,
      aggregates: getDealAggregates(d),
    }));

  return res.json(supplierDeals);
});

/**
 * GET /api/suppliers/deals/:id
 * ×¤×¨×˜×™ ×“×™×œ ×›×•×œ×œ ×¨×©×™××ª ×œ×§×•×—×•×ª
 */
router.get("/deals/:id", (req: Request, res: Response) => {
  const supplierId = getSupplierIdFromReq(req);
  const { id } = req.params;

  const deal = deals.find(
    (d) => d.id === id && d.supplierId === supplierId
  );

  if (!deal) {
    return res.status(404).json({ message: "×“×™×œ ×œ× × ××¦×" });
  }

  const aggregates = getDealAggregates(deal);

  return res.json({
    ...deal,
    aggregates,
  });
});

/**
 * (××•×¤×¦×™×•× ×œ×™) ×¡×™××•×œ×¦×™×” ×©×œ ×¨×›×™×©×” â€“ ×œ×¦×•×¨×š ×‘×“×™×§×•×ª
 * POST /api/fake-purchase
 */
router.post("/fake-purchase", (req: Request, res: Response) => {
  const { dealId, fullName, email, phone, shippingAddress, units } =
    req.body;

  const deal = deals.find((d) => d.id === dealId);

  if (!deal) {
    return res.status(404).json({ message: "×“×™×œ ×œ× × ××¦×" });
  }

  // ×§×•×‘×¢×™× ×‘××™×–×” Tier ×”×œ×§×•×— × ×•×¤×œ ×œ×¤×™ ×›××•×ª ×™×—×™×“×•×ª ××¦×˜×‘×¨×ª
  const currentTotalUnits = deal.customers.reduce(
    (sum, c) => sum + c.unitsPurchased,
    0
  );
  const newTotalUnits = currentTotalUnits + Number(units);

  // ××•×¦××™× Tier ××ª××™×
  const sortedTiers = [...deal.tiers].sort(
    (a, b) => a.minUnits - b.minUnits
  );

  let unitPrice = deal.regularPrice;

  for (const tier of sortedTiers) {
    if (
      newTotalUnits >= tier.minUnits &&
      (tier.maxUnits === undefined || newTotalUnits <= tier.maxUnits)
    ) {
      unitPrice = tier.unitPrice;
    }
  }

  const customer: DealCustomer = {
    id: "cust_" + Date.now(),
    fullName,
    email,
    phone,
    shippingAddress,
    unitsPurchased: Number(units),
    unitPricePaid: unitPrice,
    purchasedAt: new Date().toISOString(),
  };

  deal.customers.push(customer);

  return res.status(201).json({ dealId: deal.id, customer });
});

export default router;

ğŸ“ 2. ×œ×—×‘×¨ ××ª ×”×¨××•×˜ ×”×–×” ×œÖ¾Express ×”×¨××©×™

×‘Ö¾server/routes.ts (××• ××™×¤×” ×©××ª×” ×¨×•×©× ××ª ×›×œ ×”×¨××•×˜×™×):

// server/routes.ts
import { Router } from "express";
import supplierRoutes from "./supplierRoutes";

const router = Router();

// ×¨××•×˜×™× ××—×¨×™×...
// router.use("/something", someRoutes);

// ×¨××•×˜×™× ×©×œ ×¡×¤×§×™×:
router.use("/api/suppliers", supplierRoutes);

// ××¤×©×¨ ×œ×”×©××™×¨ ×’× ××ª ×©××¨ ×”×¨××•×˜×™× ×©×”×™×• ×œ×š

export default router;


×•×“× ×©×‘Ö¾server/index.ts ××• ××™×¤×” ×©××ª×” ×™×•×¦×¨ ××ª ×”×©×¨×ª ××ª×” ××©×ª××© ×‘Ö¾routes ×”××œ×”.

ğŸ’» ×—×œ×§ 2 â€“ ×¦×“ ×œ×§×•×— (React â€“ ×‘×ª×•×š client/src)

× × ×™×— ×©×™×©:

client/src/App.tsx â€“ ××¤×œ×™×§×¦×™×” ×¨××©×™×ª

client/src/pages/ â€“ ×©× × ×•×¡×™×£ ×“×£ ×œ×¡×¤×§

ğŸ“ 1. ×“×£ ×“×©×‘×•×¨×“ ×¡×¤×§ â€“ ×¢× ×“×™×œ×™× + × ×™×ª×•×— × ×ª×•× ×™×

×¦×•×¨ ×§×•×‘×¥:
client/src/pages/SupplierDashboard.tsx

// client/src/pages/SupplierDashboard.tsx
import React, { useEffect, useState } from "react";

interface DealAggregates {
  totalUnits: number;
  grossRevenue: number;
  commission: number;
  netRevenue: number;
  avgUnitPrice: number;
}

interface Deal {
  id: string;
  title: string;
  description: string;
  status: string;
  regularPrice: number;
  costPrice: number;
  createdAt: string;
  approvedAt?: string;
  closedAt?: string;
  commissionRate: number;
  aggregates: DealAggregates;
}

interface DealCustomer {
  id: string;
  fullName: string;
  email: string;
  phone: string;
  shippingAddress: string;
  unitsPurchased: number;
  unitPricePaid: number;
  purchasedAt: string;
}

export default function SupplierDashboard() {
  const [deals, setDeals] = useState<Deal[]>([]);
  const [selectedDeal, setSelectedDeal] = useState<Deal | null>(null);
  const [dealCustomers, setDealCustomers] = useState<DealCustomer[]>([]);
  const [loading, setLoading] = useState(false);

  // ×˜×¢×™× ×ª ×”×“×™×œ×™×
  useEffect(() => {
    fetchDeals();
  }, []);

  async function fetchDeals() {
    setLoading(true);
    try {
      const res = await fetch("/api/suppliers/deals");
      const data = await res.json();
      setDeals(data);
    } catch (e) {
      console.error(e);
    } finally {
      setLoading(false);
    }
  }

  async function openDealDetails(dealId: string) {
    setLoading(true);
    try {
      const res = await fetch(`/api/suppliers/deals/${dealId}`);
      const data = await res.json();
      setSelectedDeal(data);
      setDealCustomers(data.customers || []);
    } catch (e) {
      console.error(e);
    } finally {
      setLoading(false);
    }
  }

  // × ×™×ª×•×— × ×ª×•× ×™× ×›×œ×œ×™ ×œ×›×œ ×”×“×™×œ×™×
  const totalUnitsAllDeals = deals.reduce(
    (sum, d) => sum + d.aggregates.totalUnits,
    0
  );
  const totalGrossAllDeals = deals.reduce(
    (sum, d) => sum + d.aggregates.grossRevenue,
    0
  );
  const totalCommissionAllDeals = deals.reduce(
    (sum, d) => sum + d.aggregates.commission,
    0
  );
  const totalNetAllDeals = deals.reduce(
    (sum, d) => sum + d.aggregates.netRevenue,
    0
  );

  return (
    <div dir="rtl" style={{ padding: "2rem", maxWidth: 1200, margin: "0 auto" }}>
      <h1>×“×©×‘×•×¨×“ ×¡×¤×§ â€“ Deal Rush</h1>

      {loading && <p>×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>}

      {/* ×›×¨×˜×™×¡×™ ×¡×™×›×•× */}
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
          gap: "1rem",
          margin: "1.5rem 0",
        }}
      >
        <div style={cardStyle}>
          <h3>×¡×”"×› ×™×—×™×“×•×ª ×©× ××›×¨×•</h3>
          <p>{totalUnitsAllDeals}</p>
        </div>
        <div style={cardStyle}>
          <h3>×¡×”"×› ×”×›× ×¡×•×ª (×‘×¨×•×˜×•)</h3>
          <p>{totalGrossAllDeals.toFixed(2)} â‚ª</p>
        </div>
        <div style={cardStyle}>
          <h3>×¡×”"×› ×¢××œ×” ×©×©×•×œ××” ×œ×¤×œ×˜×¤×•×¨××”</h3>
          <p>{totalCommissionAllDeals.toFixed(2)} â‚ª</p>
        </div>
        <div style={cardStyle}>
          <h3>×¡×”"×› ×”×›× ×¡×•×ª × ×˜×•</h3>
          <p>{totalNetAllDeals.toFixed(2)} â‚ª</p>
        </div>
      </div>

      {/* ×˜×‘×œ×ª ×“×™×œ×™× */}
      <h2>×”×“×™×œ×™× ×©×œ×™</h2>
      <table style={tableStyle}>
        <thead>
          <tr>
            <th>×©× ×”×“×™×œ</th>
            <th>×¡×˜×˜×•×¡</th>
            <th>×™×—×™×“×•×ª</th>
            <th>××—×™×¨ ×××•×¦×¢ ×œ×™×—×™×“×”</th>
            <th>×”×›× ×¡×” ×‘×¨×•×˜×•</th>
            <th>×¢××œ×”</th>
            <th>× ×˜×•</th>
            <th>×ª××¨×™×š ×™×¦×™×¨×”</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {deals.map((deal) => (
            <tr key={deal.id}>
              <td>{deal.title}</td>
              <td>{deal.status}</td>
              <td>{deal.aggregates.totalUnits}</td>
              <td>{deal.aggregates.avgUnitPrice.toFixed(2)} â‚ª</td>
              <td>{deal.aggregates.grossRevenue.toFixed(2)} â‚ª</td>
              <td>{deal.aggregates.commission.toFixed(2)} â‚ª</td>
              <td>{deal.aggregates.netRevenue.toFixed(2)} â‚ª</td>
              <td>{new Date(deal.createdAt).toLocaleString("he-IL")}</td>
              <td>
                <button onClick={() => openDealDetails(deal.id)}>×¤×¨×˜×™×</button>
              </td>
            </tr>
          ))}
          {deals.length === 0 && !loading && (
            <tr>
              <td colSpan={9}>××™×Ÿ ×“×™×œ×™× ×œ×”×¦×’×” ×¢×“×™×™×Ÿ.</td>
            </tr>
          )}
        </tbody>
      </table>

      {/* ×¤×¨×˜×™ ×“×™×œ × ×‘×—×¨ + ×œ×§×•×—×•×ª */}
      {selectedDeal && (
        <div style={{ marginTop: "2rem" }}>
          <h2>×¤×¨×˜×™ ×“×™×œ: {selectedDeal.title}</h2>
          <p>{selectedDeal.description}</p>
          <p>×¡×˜×˜×•×¡: {selectedDeal.status}</p>
          <p>
            × ×•×¦×¨ ×‘×ª××¨×™×š:{" "}
            {new Date(selectedDeal.createdAt).toLocaleString("he-IL")}
          </p>
          {selectedDeal.approvedAt && (
            <p>
              ××•×©×¨ ×‘×ª××¨×™×š:{" "}
              {new Date(selectedDeal.approvedAt).toLocaleString("he-IL")}
            </p>
          )}
          {selectedDeal.closedAt && (
            <p>
              × ×¡×’×¨ ×‘×ª××¨×™×š:{" "}
              {new Date(selectedDeal.closedAt).toLocaleString("he-IL")}
            </p>
          )}

          <h3>×œ×§×•×—×•×ª ×•×¨×›×™×©×•×ª</h3>
          <table style={tableStyle}>
            <thead>
              <tr>
                <th>×©× ××œ×</th>
                <th>×˜×œ×¤×•×Ÿ</th>
                <th>××™×™×œ</th>
                <th>×›×ª×•×‘×ª ××©×œ×•×—</th>
                <th>×›××•×ª ×™×—×™×“×•×ª</th>
                <th>××—×™×¨ ×œ×™×—×™×“×”</th>
                <th>×ª××¨×™×š ×¨×›×™×©×”</th>
              </tr>
            </thead>
            <tbody>
              {dealCustomers.map((c) => (
                <tr key={c.id}>
                  <td>{c.fullName}</td>
                  <td>{c.phone}</td>
                  <td>{c.email}</td>
                  <td>{c.shippingAddress}</td>
                  <td>{c.unitsPurchased}</td>
                  <td>{c.unitPricePaid.toFixed(2)} â‚ª</td>
                  <td>
                    {new Date(c.purchasedAt).toLocaleString("he-IL")}
                  </td>
                </tr>
              ))}
              {dealCustomers.length === 0 && (
                <tr>
                  <td colSpan={7}>××™×Ÿ ×¢×“×™×™×Ÿ ×¨×›×™×©×•×ª ×œ×“×™×œ ×–×”.</td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}

const cardStyle: React.CSSProperties = {
  background: "#f4f4f5",
  borderRadius: "8px",
  padding: "1rem",
  boxShadow: "0 1px 3px rgba(0,0,0,0.08)",
};

const tableStyle: React.CSSProperties = {
  width: "100%",
  borderCollapse: "collapse",
  marginTop: "1rem",
};


×× ×ª×¨×¦×”, × ×•×¡×™×£ ×’× ×“×£ × ×¤×¨×“ ×œ×™×¦×™×¨×ª ×“×™×œ ×—×“×© ×¢× ×˜×•×¤×¡ â€“ ×›×¨×’×¢ ×™×© ×“×©×‘×•×¨×“ ××œ×.

ğŸ“ 2. ×œ×—×‘×¨ ××ª ×”×“×©×‘×•×¨×“ ×œ-App.tsx

×‘Ö¾client/src/App.tsx (×“×•×’××”, ×ª×ª××™× ×œ××‘× ×” ×©×œ×š):

// client/src/App.tsx
import React from "react";
import SupplierDashboard from "./pages/SupplierDashboard";

function App() {
  return (
    <div>
      {/* ×× ×™×© ×œ×š Router â€“ ×ª×©×‘×¥ ×©×.
         ×× ×œ× â€“ ×›×¨×’×¢ × ×¦×™×’ ×¨×§ ××ª ×“×©×‘×•×¨×“ ×”×¡×¤×§. */}
      <SupplierDashboard />
    </div>
  );
}

export default App;


×× ×™×© ×œ×š React Router â€“ ×ª×›× ×™×¡ ××ª ×”×§×•××¤×•× × ×˜×” ×‘×ª×•×š Route ×™×™×¢×•×“×™, ×œ×“×•×’××” /supplier.